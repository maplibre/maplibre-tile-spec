name: Publish docs

on:
  push:
    branches: [main]
  workflow_dispatch:
  pull_request:

jobs:
  gh-pages:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@0c366fd6a839edf440554fa01a7085ccba70ac98 # v4

      - uses: taiki-e/install-action@v2
        with: { tool: 'just,cargo-binstall' }

      - name: Build MLT documentation
        run: just -v docs-build

      - name: Deploy ğŸš€
        if: github.event_name != 'pull_request' && github.ref == 'refs/heads/main' && github.repository_owner == 'maplibre'
        uses: JamesIves/github-pages-deploy-action@d92aa235d04922e8f08b40ce78cc5442fcfbfa2f # v4.8.0
        with: { branch: gh-pages, folder: site }

      - run: just -v assert-git-is-clean
